
<!-- 

	WorldChat Online main chat page
	Copyright (c) @shaunakg
	Licensed under the MIT License

 -->


<!doctype html>
<html>
 	<head>
		<title>WorldChat Online</title>
		
		<link rel="stylesheet" href="chat.css">
		<title>WorldChat Online</title>

		<script src="/socket.io/socket.io.js"></script>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		
		<script>

		var privUsers;

		$(function () {
			var socket = io();

			socket.emit("client-starting-package", $('#uid').val());

			$('form').submit(function(e){
				e.preventDefault(); // prevents page reloading
				socket.emit('chat message', [$('#uid').val(), $('#m').val()]);
				$('#m').val('');
				return false;
			});

			socket.on('server-starting-package', function (data) {
				privUsers = data[0];
				socket.emit("chat message", [$('#uid').val(), "New user! (" + data[1] + ")"]);
				$('#m').prop("placeholder", "");
				$('#m').prop("disabled", false);
				$('#send-btn').prop("disabled", false);
			});

			socket.on('chat message', function(msg){

				if (msg[0].toLowerCase() == $('#uid').val().toLowerCase()) {
					$('#messages').append($('<li class="my-message">').text("[" + msg[0] + "] " + msg[1]));
				} else if (privUsers.includes(msg[0].toLowerCase())) {
					$('#messages').append($('<li class="admin-message">').text("[" + msg[0] + "] " + msg[1]));
				} else {
					$('#messages').append($('<li class="their-message">').text("[" + msg[0] + "] " + msg[1]));
				}

			});

			socket.on('client-action', function (action) {
				if (action[0] == 0) { // reload
					window.location.reload();
				}
			})

		});
		</script>
	 </head>
	 
 	<body>

		<button id="id-btn" class="id-btn material-icons">face</button>

		<ul id="messages"></ul>
		<form action="">
			<input type="hidden" value="" id="uid">
			<input id="m" autocomplete="off" placeholder="Please wait, waiting for server provisioning..." required disabled><button id="send-btn" class="btn send-btn" disabled>Send</button>
		</form>

 	</body>

	<script>

	function makeid(length) {
		var result           = '';
		var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
		var charactersLength = characters.length;
		for ( var i = 0; i < length; i++ ) {
			result += characters.charAt(Math.floor(Math.random() * charactersLength));
		}
		return result;
	}
	
	$('#uid').val(makeid(5));

	$('#id-btn').click(function (e) {
		e.preventDefault();
		$('#uid').val(prompt("Please enter a user ID:", $("#uid").val()));
	})
	
 	</script>
</html>
