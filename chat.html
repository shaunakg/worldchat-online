<!doctype html>
<html>
 	<head>
		<title>WorldChat Online</title>
		
		<link rel="stylesheet" href="chat.css">
		<title>WorldChat Online</title>

		<script src="/socket.io/socket.io.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		
		<script>
		$(function () {
			var socket = io();

			socket.emit("chat message", [$('#uid').val(), "A wild new user has arrived!"]);

			$('form').submit(function(e){
				e.preventDefault(); // prevents page reloading
				socket.emit('chat message', [$('#uid').val(), $('#m').val()]);
				$('#m').val('');
				return false;
			});

			socket.on('chat message', function(msg){

				if (msg[0] == $('#uid').val()) {
					$('#messages').append($('<li class="my-message">').text("[" + msg[0] + "] " + msg[1]));
				} else if (msg[0] == "ADMIN") {
					$('#messages').append($('<li class="admin-message">').text("[" + msg[0] + "] " + msg[1]));
				} else {
					$('#messages').append($('<li class="their-message">').text("[" + msg[0] + "] " + msg[1]));
				}

			});

		});
		</script>
	 </head>
	 
 	<body>

		<ul id="messages"></ul>
		<form action="">
			<input type="hidden" value="" id="uid">
			<input id="m" autocomplete="off" required><button>Send</button>
		</form>

 	</body>

	<script>

	function makeid(length) {
		var result           = '';
		var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
		var charactersLength = characters.length;
		for ( var i = 0; i < length; i++ ) {
			result += characters.charAt(Math.floor(Math.random() * charactersLength));
		}
		return result;
	}
	
	$('#uid').val(makeid(5));
	
 	</script>
</html>
